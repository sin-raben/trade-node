/*eslint no-console: 0, "quotes": [0, "single"], module: 0, globals:[0, "obj"]*/
/*eslint no-unused-vars: ["error", { "args": "none" }]*/
/**
 "f010005g": {
			"title": "Пользователи",
			"info": "Получить список пользователей со всеми реквизитами",
			"example body": {},
			"example return": {}
		}
 */
'use strict';
exports.fun = function (client, obj, db) {
	return new Promise(function (resolve, reject) {
		if (!(client.auth)) {
			resolve({ "result": false });
			return;
		}
		var q = "";
		if (obj.u_id) {
			q += `SELECT
					u_id,
					u_login,
					u_pass,
					p_id,
					u_permission,
					extract(EPOCH FROM u_mtime) :: INTEGER AS u_mtime
				FROM (VALUES `;
			for (let i = 0; i < obj.u_id.length; i++) {
				if (i) q += ',';
				q += `(${obj.u_id[i]})`;
				//val.push(upd[i].u_id);
			}
			q += `) AS s(id)  JOIN trade.users u ON (s.id = u.u_id);`;
		}
		else {
			q = `SELECT 
					u_id as u_id,
					u_login,
					u_pass,
					p_id,
					u_permission,
					extract(epoch from u_mtime)::integer as u_mtime
				FROM trade.users;`;
		}
		db.query(q, [obj.token, client.idToken]).then(
			(value) => {
				resolve({ "data": value });
			});
	});
};