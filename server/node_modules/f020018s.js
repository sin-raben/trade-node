/*eslint no-console: 0, "quotes": [0, "single"], module: 0, globals:[0, "obj"]*/
/*eslint no-unused-vars: ["error", { "args": "none" }]*/
/*"f020018s": {
            "title": "Новости",
            "info": "Добавление новости"
        } */
'use strict';
exports.fun = function (client, obj, db) {
	return new Promise(function (resolve, reject) {
		if (!(client.idToken)) {
			resolve({ "result": false });
			return;
		}
		var q = `INSERT INTO trade.links_news (n_id, at_id, any_id) VALUES`;
		/*let obj = {
			title: "Заголовок",
			text: "",
			data: null,
			type: 1,
			links: [
				{
					at: 4,
					any: 1
				}, {
					at: 4,
					any: 1
				}
			]

		};*/

		db.one("INSERT INTO trade.news (n_date, n_title, n_text, n_data, n_type) VALUES	(now(), ${title}, ${text}, ${data}, ${type}) RETURNING trade.news.n_id;", obj).then(
			(news) => {
				for (var i = 0; i < obj.links.length; i++) {
					if (i) q = q + ',';
					q = q + '(' + news.n_id + ',' + obj.links[i].at + ',' + obj.links[i].any + ')';
				}
				db.none(q).then(
					(a) => { resolve({ result: true }); },
					(e) => { console.error(e); resolve({ result: false }); }
				);
			}, (e) => { console.error(e); resolve({ result: false }); });
	});
};