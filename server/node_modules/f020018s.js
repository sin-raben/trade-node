/*eslint no-console: 0, "quotes": [0, "single"], module: 0, globals:[0, "obj"]*/
/*eslint no-unused-vars: ["error", { "args": "none" }]*/
/*"f020018s": {
            "title": "Новости",
            "info": "Добавление новости"
        } */
'use strict';
exports.fun = function (client, obj, db) {
	return new Promise(function (resolve, reject) {
		if (!(client.auth)) {
			resolve({ "result": false, "sync": obj.sync });
			return;
		}
		console.log("object",obj);
		/*let obj = {
			title: "Заголовок",
			text: "",
			data: null,
			type: 1,
			links: [
				{
					at: 4,
					any: 1
				}, {
					at: 4,
					any: 1
				}
			]

		};*/
		if (!obj.n_data) obj.n_data = {};
		if (!obj.n_type) obj.n_type = 1;
		db.one("INSERT INTO trade.news (n_date, n_title, n_text, n_data, n_type) VALUES	(now(), ${n_title}, ${n_text}, ${n_data}, ${n_type}) RETURNING trade.news.n_id;", obj).then(
			(news) => {
				console.log(news);
				var q = `INSERT INTO trade.links_news (n_id, at_id, any_id) VALUES`;
				for (var i = 0; i < obj.links.length; i++) {
					if (i) q = q + ',';
					q = q + '(' + news.n_id + ',' + obj.links[i].at + ',' + obj.links[i].any + ')';
				}
				db.none(q).then(
					(a) => { resolve({ result: true, "sync": obj.sync }); },
					(e) => { console.error(2, e); resolve({ result: false, "sync": obj.sync }); }
				);
			}, (e) => { console.error(1, e); resolve({ result: false, "sync": obj.sync }); });
	});
};