/*eslint no-console: 0, "quotes": [0, "single"], module: 0, globals:[0, "obj"]*/
/*eslint no-unused-vars: ["error", { "args": "none" }]*/
/** @method f020029s результат взаимодействия пользователя с новостью
 * @example "f020029s": {
 * 			"title": "результат взаимодействия пользователя с новостью",
 * 			"info": "",
 * 			"example body": {
 * 				"n_id": 123,
 * 				"na_action": 2,
 * 				"na_data":{}
 * 			},
 * 			"example return": {
 * 				"rusult": true
 * 			}
 * 		},
 */
"use strict";
exports.fun = function(client, obj, db) {
	return new Promise(function(resolve, reject) {
		if (!client.idToken) {
			resolve({ result: false, sync: obj.sync });
			return;
		}
		console.log("object", obj);
		if (!obj.n_data) obj.na_data = {};
		var q = `INSERT INTO trade.news_action (
					n_id, u_id, na_action, na_data
					) VALUES ($1, $2, $3, $4)
					ON CONFLICT (n_id, u_id)
					DO UPDATE SET
						na_action = EXCLUDED.na_action,
						na_data   = EXCLUDED.na_data,
						na_mtime  = now();`;
		db.none(q, [obj.n_id, client.u_id, obj.na_action, obj.na_data]).then(
			a => resolve({ result: true, sync: obj.sync }),
			e => {
				console.error(2, e);
				resolve({ result: false, sync: obj.sync });
			}
		);
	});
};
