/*eslint no-console: 0, "quotes": [0, "single"], module: 0, globals:[0, "obj"]*/
/*eslint no-unused-vars: ["error", { "args": "none" }]*/
/*"f010002s": {
            "title": "Авторизация",
            "info": "Авторизует пользователя"
        }, */
'use strict';
exports.fun = function (client, obj, db) {
	//TODO FUN authUser
	return new Promise(function (resolve, reject) {
		try {
			console.log("obj", obj);
			db.query(`SELECT t.t_id,t.t_name,t.t_key,u.u_login,u.u_pass from trade.token t
  							LEFT JOIN trade.users u ON t.u_id = u.u_id where t_name=$1;`,
				obj.idToken).then((token) => {
					if (token[0]) {
						//t_id: 7, t_key: '1', u_login: 'gofman', u_pass: '1'
						//console.log("token[0]", token[0]);
						client.idToken = token[0].t_name;
						client.user = token[0].u_login;
						client.t_id = token[0].t_id;
						if ((token[0].u_login === obj.authData.login) && (token[0].u_pass === obj.authData.password)) {
							resolve({ "result": true });
						} else {
							resolve({ "result": false });
						}
					} else {
						resolve({ "result": false });
						console.error(obj.idToken + " нет такого токена");
					}
				}).catch((error) => {
					console.log("error1", error);
					reject(error);
				});/**/
		} catch (err) {
			console.log("errA", err);
		}

	});
};