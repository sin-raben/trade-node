/*eslint no-console: 0, "quotes": [0, "single"], module: 0, globals:[0, "obj"]*/
/*eslint no-unused-vars: ["error", { "args": "none" }]*/
/*"f020004s": {
            "title": "Координаты",
            "info": "Мобильный клиент отправляет на сервер координаты"
        }, */
'use strict';
exports.fun = function (client, obj, db) {
	return new Promise(function (resolve, reject) {
		if (!(client.idToken)) {
			resolve({ "result": false });
			return;
		}
		console.log("obj", obj);
		var coord,
			res;
		var vr = (value) => {
			console.log("value", value);
		};
		var ve = (err) => {
			console.log("err", err);
		};
		for (var i = 0; i < obj.points.length; i++) {
			coord = "(" + obj.points[i].coord.lat + "," + obj.points[i].coord.lon + ")";
			res = {
				"idToken": client.idToken,
				"coord": coord,
				"time": new Date(obj.points[i].time * 1000),
				"token": client.t_id,
				"event": obj.points[i].event
				//"atime": new Date()
			};
			try {
				db.query("INSERT INTO trade.log_coords (lc_coord, lc_time, lc_token, lc_event) VALUES (${coord}, ${time}, ${token}, ${event});", res).then(vr, ve);
			} catch (err) { reject(err); }
			console.log("setLogCoord", res);
		}

		resolve({ "result": true });
	});
};