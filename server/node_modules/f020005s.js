/*eslint no-console: 0, "quotes": [0, "single"], module: 0, globals:[0, "obj"]*/
/*eslint no-unused-vars: ["error", { "args": "none" }]*/
/*"f020005s": {
            "title": "Звонки",
            "info": "Мобильный клиент отправляет на сервер информацию о звонках"
        }, */
'use strict';
exports.fun = function (client, obj, db) {
	return new Promise(function (resolve, reject) {
		if (!(client.idToken)) {
			resolve({ "result": false, "sync": obj.sync });
			return;
		}
		var st = `INSERT INTO trade.log_calls (t_id, lc_stime, lc_billsec, lc_phone, lc_name, lc_incoming) VALUES `, arr = [];

		for (var i = 0; i < obj.data.length; i++) {
			let call = obj.data[i];
			arr.push(client.t_id);
			arr.push(call.lc_stime);
			arr.push(call.lc_billsec);
			arr.push(call.lc_phone);
			arr.push(call.lc_name);
			arr.push(!!call.lc_incoming);
			if (i !== 0) st = st + ",";
			st += "($" + (i * 6 + 1) + ", to_timestamp($" + (i * 6 + 2) + "), $" + (i * 6 + 3) + ",$" + (i * 6 + 4) + ",$" + (i * 6 + 5) + ",$" + (i * 6 + 6) + ")";
		}
		st += ` RETURNING trade.log_calls.lc_id;`;
		console.log(st, arr);
		db.query(st, arr).then(
			(data) => {
				resolve({ data, return: true, "sync": obj.sync });
			},
			error => {
				resolve({ return: false, "sync": obj.sync });
			});
	});
};